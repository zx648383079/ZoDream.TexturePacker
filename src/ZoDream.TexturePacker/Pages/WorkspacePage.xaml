<?xml version="1.0" encoding="utf-8"?>
<Page
    x:Class="ZoDream.TexturePacker.Pages.WorkspacePage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:ZoDream.TexturePacker.Pages"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:skia="using:SkiaSharp.Views.Windows"
    xmlns:vm="using:ZoDream.TexturePacker.ViewModels"
    xmlns:ctl="using:ZoDream.TexturePacker.Controls"
    xmlns:bhv="using:ZoDream.TexturePacker.Behaviors"
    xmlns:ivy="using:Microsoft.Xaml.Interactivity"
    mc:Ignorable="d">

    <Page.DataContext>
        <vm:WorkspaceViewModel/>
    </Page.DataContext>
    <Page.Resources>
        <DataTemplate x:Key="LayerTemplate" x:DataType="vm:LayerViewModel">
            <TreeViewItem AutomationProperties.Name="{Binding Name}"
                          ItemsSource="{Binding Children}" IsExpanded="True">
                <Grid Height="60">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="60"/>
                        <ColumnDefinition/>
                        <ColumnDefinition Width="30"/>
                        <ColumnDefinition Width="30"/>
                    </Grid.ColumnDefinitions>
                    <Image Source="{Binding PreviewImage}" Stretch="UniformToFill"/>
                    <TextBlock Text="{Binding Name}" 
                               Grid.Column="1" VerticalAlignment="Center"/>
                    <CheckBox IsChecked="{Binding IsVisible, Mode=TwoWay}" Grid.Column="2" VerticalAlignment="Center"/>
                    <CheckBox IsChecked="{Binding IsLocked, Mode=TwoWay}" Grid.Column="3" VerticalAlignment="Center"/>
                </Grid>
            </TreeViewItem>
        </DataTemplate>
        <ctl:LayerItemTemplateSelector x:Key="LayerItemTemplateSelector" LayerTemplate="{StaticResource LayerTemplate}"/>
    </Page.Resources>
    
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="auto"/>
            <RowDefinition Height="auto"/>
            <RowDefinition/>
            <RowDefinition Height="auto"/>
        </Grid.RowDefinitions>
        <MenuBar>
            <MenuBarItem Title="文件">
                <MenuFlyoutItem Text="新建" Command="{Binding NewCommand}">
                    <MenuFlyoutItem.KeyboardAccelerators>
                        <KeyboardAccelerator Modifiers="Control" Key="N"/>
                    </MenuFlyoutItem.KeyboardAccelerators>
                </MenuFlyoutItem>
                <MenuFlyoutItem Text="打开" Command="{Binding OpenCommand}">
                    <MenuFlyoutItem.KeyboardAccelerators>
                        <KeyboardAccelerator Modifiers="Control" Key="O"/>
                    </MenuFlyoutItem.KeyboardAccelerators>
                </MenuFlyoutItem>
                <MenuFlyoutSeparator/>
                <MenuFlyoutItem Text="保存" Command="{Binding SaveCommand}">
                    <MenuFlyoutItem.KeyboardAccelerators>
                        <KeyboardAccelerator Modifiers="Control" Key="S"/>
                    </MenuFlyoutItem.KeyboardAccelerators>
                </MenuFlyoutItem>
                <MenuFlyoutSeparator/>
                <MenuFlyoutItem Text="导入" Command="{Binding ImportCommand}"/>
                <MenuFlyoutItem Text="导出" Command="{Binding ExportCommand}"/>
                <MenuFlyoutSeparator/>
                <MenuFlyoutItem Text="退出" Command="{Binding ExitCommand}">
                    <MenuFlyoutItem.KeyboardAccelerators>
                        <KeyboardAccelerator Modifiers="Control" Key="E"/>
                    </MenuFlyoutItem.KeyboardAccelerators>
                </MenuFlyoutItem>
            </MenuBarItem>
            <MenuBarItem Title="编辑">
                <MenuFlyoutItem Text="取消选中" Command="{Binding UnselectCommand}"/>
                <MenuFlyoutSeparator/>
                <MenuFlyoutItem Text="撤销" Command="{Binding UndoCommand}">
                    <MenuFlyoutItem.KeyboardAccelerators>
                        <KeyboardAccelerator Modifiers="Control" Key="Z"/>
                    </MenuFlyoutItem.KeyboardAccelerators>
                </MenuFlyoutItem>
                <MenuFlyoutItem Text="重做" Command="{Binding RedoCommand}">
                    <MenuFlyoutItem.KeyboardAccelerators>
                        <KeyboardAccelerator Modifiers="Control" Key="Y"/>
                    </MenuFlyoutItem.KeyboardAccelerators>
                </MenuFlyoutItem>
                <MenuFlyoutItem Text="剪切" Command="{Binding CutCommand}">
                    <MenuFlyoutItem.KeyboardAccelerators>
                        <KeyboardAccelerator Modifiers="Control" Key="X"/>
                    </MenuFlyoutItem.KeyboardAccelerators>
                </MenuFlyoutItem>
                <MenuFlyoutItem Text="复制" Command="{Binding CopyCommand}">
                    <MenuFlyoutItem.KeyboardAccelerators>
                        <KeyboardAccelerator Modifiers="Control" Key="C"/>
                    </MenuFlyoutItem.KeyboardAccelerators>
                </MenuFlyoutItem>
                <MenuFlyoutItem Text="粘贴" Command="{Binding PasteCommand}">
                    <MenuFlyoutItem.KeyboardAccelerators>
                        <KeyboardAccelerator Modifiers="Control" Key="V"/>
                    </MenuFlyoutItem.KeyboardAccelerators>
                </MenuFlyoutItem>
                <MenuFlyoutSeparator/>
                <MenuFlyoutItem Text="属性" Command="{Binding PropertyCommand}"/>
                <RadioMenuFlyoutItem Text="透明背景" IsChecked="True" Command="{Binding TransparentCommand}"/>
                <MenuFlyoutSeparator/>
                <MenuFlyoutSubItem Text="排列">
                    <MenuFlyoutItem Text="上下布局" Command="{Binding OrderCommand}" CommandParameter="TopDown"/>
                    <MenuFlyoutItem Text="左右布局" Command="{Binding OrderCommand}" CommandParameter="LeftRight"/>
                    <MenuFlyoutItem Text="对角布局" Command="{Binding OrderCommand}" CommandParameter="Diagonal"/>
                    <MenuFlyoutItem Text="斜对角布局" Command="{Binding OrderCommand}" CommandParameter="AltDiagonal"/>
                    <MenuFlyoutItem Text="二叉树布局" Command="{Binding OrderCommand}" CommandParameter="BinaryTree"/>
                </MenuFlyoutSubItem>
            </MenuBarItem>
            <MenuBarItem Title="帮助">
                <MenuFlyoutItem Text="关于" Command="{Binding AboutCommand}">
                    <MenuFlyoutItem.KeyboardAccelerators>
                        <KeyboardAccelerator Modifiers="Control" Key="I"/>
                    </MenuFlyoutItem.KeyboardAccelerators>
                </MenuFlyoutItem>
            </MenuBarItem>
        </MenuBar>
        <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition/>
                <ColumnDefinition/>
            </Grid.ColumnDefinitions>
            <StackPanel Orientation="Horizontal">
                <Button Content="打开项目"/>
                <Button Content="保存项目"/>
                <Button Content="添加精灵"/>
                <Button Content="删除精灵"/>
            </StackPanel>
        </Grid>
        <Grid Grid.Row="2">
            <Grid.ColumnDefinitions>
                <ColumnDefinition/>
                <ColumnDefinition Width="300"/>
            </Grid.ColumnDefinitions>
            <ctl:ImageEditor x:Name="Editor" AllowDrop="True"
                             SelectedCommand="{Binding EditorSelectedCommand}">
                <ivy:Interaction.Behaviors>
                    <bhv:DragFileBehavior Command="{Binding DragImageCommand}"/>
                </ivy:Interaction.Behaviors>
            </ctl:ImageEditor>

            <TreeView Grid.Column="1" ItemsSource="{Binding LayerItems}" 
                      ItemTemplateSelector="{StaticResource LayerItemTemplateSelector}"
                      SelectedItem="{Binding SelectedLayer,Mode=TwoWay}">
                <ivy:Interaction.Behaviors>
                    <bhv:SelectionChangedBehavior Command="{Binding LayerSelectedCommand}"/>
                </ivy:Interaction.Behaviors>
            </TreeView>
        </Grid>
        
        <Grid Grid.Row="3">
            
        </Grid>
    </Grid>
</Page>
